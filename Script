-- Flee the Facility UI - BMF

-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Instance Helper
local function new(class, props, parent)
    local obj = Instance.new(class)
    if props then for k,v in pairs(props) do obj[k] = v end end
    if parent then obj.Parent = parent end
    return obj
end

-- ScreenGui Root
local screenGui = new("ScreenGui", {Name = "BMF_UI_FTF", ResetOnSpawn = false}, playerGui)

-- Main Window
local main = new("Frame", {
    Size = UDim2.new(0,520,0,520),
    Position = UDim2.new(0.5,-260,0.5,-260),
    BackgroundColor3 = Color3.fromRGB(15,15,15),
    BorderSizePixel = 0,
}, screenGui)
new("UICorner", {CornerRadius = UDim.new(0,10)}, main)
new("UIStroke", {Color = Color3.fromRGB(120,0,0), Thickness = 1, Transparency = 0.3}, main)

-- Title Bar
local titleBar = new("Frame", {
    Parent = main,
    Size = UDim2.new(1,0,0,48),
    BackgroundColor3 = Color3.fromRGB(120,0,0)
})
new("UICorner", {CornerRadius = UDim.new(0,8)}, titleBar)

local titleLabel = new("TextLabel", {
    Parent = titleBar,
    Text = "Flee The Facility - BMF UI",
    BackgroundTransparency = 1,
    Size = UDim2.new(1,-110,1,0),
    Position = UDim2.new(0,16,0,0),
    Font = Enum.Font.GothamBold,
    TextSize = 20,
    TextColor3 = Color3.fromRGB(255,255,255),
    TextXAlignment = Enum.TextXAlignment.Left,
})

-- Dragging 
local dragging, dragStart, startPos
titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = main.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Minimize Button
local toggleBtn = new("TextButton", {
    Parent = titleBar,
    Size = UDim2.new(0,90,0,30),
    Position = UDim2.new(1,-96,0,9),
    Text = "Minimize",
    TextColor3 = Color3.fromRGB(255,255,255),
    BackgroundColor3 = Color3.fromRGB(90,0,0),
    Font = Enum.Font.Gotham,
    TextSize = 14,
    BorderSizePixel = 0,
})
new("UICorner", {CornerRadius = UDim.new(0,6)}, toggleBtn)

local minimized = false
toggleBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    main.Visible = not minimized
end)

-- Logger
local errFrame = new("Frame", {
    Parent = main,
    Size = UDim2.new(1,-24,0,30),
    Position = UDim2.new(0,12,0,56),
    BackgroundColor3 = Color3.fromRGB(40,0,0),
    BorderSizePixel = 0,
})
new("UICorner", {CornerRadius = UDim.new(0,6)}, errFrame)

local errLabel = new("TextLabel", {
    Parent = errFrame,
    Text = "Logging: None",
    BackgroundTransparency = 1,
    Size = UDim2.new(1,-12,1,0),
    Position = UDim2.new(0,6,0,0),
    Font = Enum.Font.Gotham,
    TextSize = 14,
    TextColor3 = Color3.fromRGB(255,100,100),
    TextXAlignment = Enum.TextXAlignment.Left,
})

local function setError(t) errLabel.Text = "Logging: " .. tostring(t or "None") end

-- Tabs & Sections
local divider = new("Frame", {Parent = main, Size = UDim2.new(0,2,1,-118), Position = UDim2.new(0,152,0,90), BackgroundColor3 = Color3.fromRGB(90,0,0)})

local tabsPanel = new("Frame", {Parent = main, Size = UDim2.new(0,152,1,-118), Position = UDim2.new(0,0,0,90), BackgroundTransparency = 1})
new("UIListLayout", {Padding = UDim.new(0,8), SortOrder = Enum.SortOrder.LayoutOrder}, tabsPanel)
new("UIPadding", {PaddingLeft = UDim.new(0,12), PaddingTop = UDim.new(0,8)}, tabsPanel)

local buttonsPanel = new("ScrollingFrame", {
    Parent = main,
    Size = UDim2.new(1,-180,1,-118),
    Position = UDim2.new(0,176,0,90),
    BackgroundTransparency = 1,
    ScrollBarThickness = 6,
})
local buttonsLayout = new("UIListLayout", {Padding = UDim.new(0,8), SortOrder = Enum.SortOrder.LayoutOrder}, buttonsPanel)
new("UIPadding", {PaddingLeft = UDim.new(0,6), PaddingRight = UDim.new(0,6), PaddingTop = UDim.new(0,6)}, buttonsPanel)

local function updateCanvas()
    RunService.Heartbeat:Wait()
    buttonsPanel.CanvasSize = UDim2.new(0,0,0, buttonsLayout.AbsoluteContentSize.Y + 12)
end

-- Button Creator
local function makeButton(text)
    local btn = new("TextButton", {
        Parent = buttonsPanel,
        Size = UDim2.new(1,0,0,40),
        BackgroundColor3 = Color3.fromRGB(35,0,0),
        Text = text,
        Font = Enum.Font.Gotham,
        TextSize = 15,
        TextColor3 = Color3.fromRGB(255,255,255),
        AutoButtonColor = false,
        BorderSizePixel = 0,
    })
    new("UICorner", {CornerRadius = UDim.new(0,6)}, btn)

    btn.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Color3.fromRGB(150,0,0)}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.12), {BackgroundColor3 = Color3.fromRGB(35,0,0)}):Play()
    end)

    return btn
end

local function populateWIP()
    for _=1,6 do 
        local b = makeButton("WIP Feature")
        b.MouseButton1Click:Connect(function() setError("Feature not added yet") end)
    end
    updateCanvas()
end

-- Tabs List
local tabNames = {"Player","Beast","Survivor","ESP","Teleports","Misc","Scripts"}

for _,name in ipairs(tabNames) do
    local tbtn = new("TextButton", {
        Parent = tabsPanel,
        Size = UDim2.new(1,-24,0,40),
        BackgroundColor3 = Color3.fromRGB(35,0,0),
        Text = name,
        Font = Enum.Font.Gotham,
        TextSize = 15,
        TextColor3 = Color3.fromRGB(255,255,255),
        BorderSizePixel = 0,
    })
    new("UICorner", {CornerRadius = UDim.new(0,6)}, tbtn)

    tbtn.MouseButton1Click:Connect(function()
        for _,b in ipairs(tabsPanel:GetChildren()) do
            if b:IsA("TextButton") then b.BackgroundColor3 = Color3.fromRGB(35,0,0) end
        end
        tbtn.BackgroundColor3 = Color3.fromRGB(150,0,0)

        for _, child in pairs(buttonsPanel:GetChildren()) do
            if child:IsA("TextButton") then child:Destroy() end
        end

        if name == "Scripts" then
            local function scriptBtn(btnName, url)
                local b = makeButton(btnName)
                b.MouseButton1Click:Connect(function()
                    setError("Executing: " .. btnName)
                    loadstring(game:HttpGet(url))()
                end)
            end

            scriptBtn("Infinite Yield", "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source")
            scriptBtn("Dex Explorer", "https://raw.githubusercontent.com/infyiff/backup/main/dex.lua")
            scriptBtn("FTF HAX", "https://raw.githubusercontent.com/LeviTheOtaku/roblox-scripts/main/FTFHAX.lua")
            scriptBtn("Luaware", "https://raw.githubusercontent.com/bedra45/Random-games-xd/main/bedraFtfFinalGUI")

            updateCanvas()
            return
        end

        populateWIP()
    end)
end

-- Default Tab
populateWIP()
setError("âœ… UI Loaded!")
